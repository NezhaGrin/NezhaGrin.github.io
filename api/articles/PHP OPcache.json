{"title":"PHP OPcache","uid":"b32d75702aae27ea0c5ed039ca55a478","slug":"PHP OPcache","date":"2024-02-27T05:04:33.000Z","updated":"2024-02-27T10:42:21.545Z","comments":true,"path":"api/articles/PHP OPcache.json","keywords":null,"cover":null,"content":"<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>💡 Tips： 在 PHP 5.5 版本中引入的 OPCache，是 PHP 代码执行的重要组成部分。OPCache 是一个开源的 PHP 扩展，<strong>OPCache 的目地是避免重复编译，减少 CPU 和内存开销</strong>。，从而提高 PHP 脚本的性能和响应速度。</p></blockquote>\n<h3 id=\"什么是-OPCache？\"><a href=\"#什么是-OPCache？\" class=\"headerlink\" title=\"什么是 OPCache？\"></a>什么是 OPCache？</h3><p>OPCache 的全称是“Opcode Cache”，它的主要功能是将 PHP 脚本编译成字节码（opcode）并缓存起来。这样，在下一次请求同一脚本时，PHP 不需要重新编译脚本，而是直接使用缓存的字节码，从而减少了服务器的 CPU 和内存消耗，提高了脚本的执行速度。</p>\n<h3 id=\"OPCache-的工作原理\"><a href=\"#OPCache-的工作原理\" class=\"headerlink\" title=\"OPCache 的工作原理\"></a>OPCache 的工作原理</h3><ul>\n<li><strong>编译和缓存</strong>：当 PHP 脚本第一次被请求时，PHP 引擎会将脚本解析、编译成字节码，并将字节码缓存到内存中；</li>\n<li><strong>下一次请求</strong>：当同一个脚本再次被请求时，PHP 引擎会首先检查缓存中是否存在该脚本的字节码。如果存在，则直接使用缓存的字节码执行，而不需要重新编译；</li>\n<li><strong>更新策略</strong>：当脚本文件发生变更（例如被修改、更新），OPCache 会自动失效对应的缓存，以确保代码变更能够及时生效；</li>\n</ul>\n<h3 id=\"OPCache-的优势\"><a href=\"#OPCache-的优势\" class=\"headerlink\" title=\"OPCache 的优势\"></a>OPCache 的优势</h3><ul>\n<li><strong>提高性能</strong>：避免了重复的编译过程，减少了 CPU 和内存的消耗，从而提高了 PHP 脚本的执行速度；</li>\n<li><strong>降低服务器负载</strong>：减少了 PHP 编译的次数，降低了服务器的负载，提高了服务器的并发处理能力；</li>\n<li><strong>改善用户体验</strong>：加速了 PHP 脚本的执行速度，提高了网站的响应速度，改善了用户的体验；</li>\n</ul>\n<div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">TIP</p>\n<p>编译是非常吃服务器的 CPU 和内存的，避免了重复编译并且缓存在内存当中，确实对于性能和处理的速度大大的提高了很多。</p>\n</div>\n<h3 id=\"如何启用-OPCache？\"><a href=\"#如何启用-OPCache？\" class=\"headerlink\" title=\"如何启用 OPCache？\"></a>如何启用 OPCache？</h3><p>在 PHP 5.5 版本之后，OPCache 已经默认包含在 PHP 核心中。要启用 OPCache，只需要在 PHP 配置文件中进行相应的设置即可。</p>\n<h4 id=\"官方推荐配置\"><a href=\"#官方推荐配置\" class=\"headerlink\" title=\"官方推荐配置\"></a>官方推荐配置</h4><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">opcache.memory_consumption=128</span></span><br><span class=\"line\"><span class=\"string\">opcache.interned_strings_buffer=8</span></span><br><span class=\"line\"><span class=\"string\">opcache.max_accelerated_files=4000</span></span><br><span class=\"line\"><span class=\"string\">opcache.revalidate_freq=60</span></span><br><span class=\"line\"><span class=\"string\">opcache.fast_shutdown=1</span></span><br><span class=\"line\"><span class=\"string\">opcache.enable_cli=1</span> <span class=\"string\">;</span> <span class=\"string\">prior</span> <span class=\"string\">to</span> <span class=\"string\">PHP</span> <span class=\"number\">7.2</span><span class=\"number\">.0</span></span><br></pre></td></tr></table></figure>\n\n<div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">当然，以下是每个参数的简要描述：</p>\n<ul>\n<li><strong>opcache.memory_consumption&#x3D;128</strong>：定义 OPCache 使用的内存量（MB）；</li>\n<li><strong>opcache.interned_strings_buffer&#x3D;8</strong>：定义存储内部字符串的内存缓冲区大小（MB）；</li>\n<li><strong>opcache.max_accelerated_files&#x3D;4000</strong>：定义 OPCache 可以缓存的最大文件数量；</li>\n<li><strong>opcache.revalidate_freq&#x3D;60</strong>：定义 OPCache 重新验证脚本文件是否发生变化的频率（秒）；</li>\n<li><strong>opcache.fast_shutdown&#x3D;1</strong>：启用快速关闭功能，加速 PHP 进程的关闭；</li>\n<li><strong>opcache.enable_cli&#x3D;1</strong>：在 PHP 7.2.0 之前启用 OPCache CLI 模式，用于命令行脚本的缓存；</li>\n</ul>\n\n</div>\n<h4 id=\"Laravel-推荐配置\"><a href=\"#Laravel-推荐配置\" class=\"headerlink\" title=\"Laravel 推荐配置\"></a>Laravel 推荐配置</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">opcache.enable=1</span><br><span class=\"line\">opcache.memory_consumption=64      # laravel 推荐 256</span><br><span class=\"line\">opcache.interned_strings_buffer=16</span><br><span class=\"line\">opcache.max_accelerated_files=4000 # 这里的文件要比项目多</span><br><span class=\"line\">opcache.revalidate_freq=0</span><br><span class=\"line\">opcache.validate_timestamps=0      # 开发环境为 1，生产环境为 0</span><br></pre></td></tr></table></figure>\n\n<div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">以下是每个参数的简要描述：</p>\n<p><ol>\n<li><strong>opcache.enable&#x3D;1</strong>：启用 OPCache；</li>\n<li><strong>opcache.memory_consumption&#x3D;64</strong>：定义 OPCache 使用的内存量（MB），推荐值为 256MB，但在资源受限的情况下，可以调整为较小的值；</li>\n<li><strong>opcache.interned_strings_buffer&#x3D;16</strong>：定义存储内部字符串的内存缓冲区大小（MB）；</li>\n<li><strong>opcache.max_accelerated_files&#x3D;4000</strong>：定义 OPCache 可以缓存的最大文件数量，建议设置为比项目中文件数量多一些；</li>\n<li><strong>opcache.revalidate_freq&#x3D;0</strong>：定义 OPCache 重新验证脚本文件是否发生变化的频率（秒），设置为 0 表示关闭重新验证；</li>\n<li><strong>opcache.validate_timestamps&#x3D;0</strong>：在开发环境设置为 1，表示验证文件的时间戳以检查是否需要重新编译；在生产环境设置为 0，关闭时间戳验证以提高性能；</li>\n</ol>\n</p>\n</div>\n<h3 id=\"有坑请注意\"><a href=\"#有坑请注意\" class=\"headerlink\" title=\"有坑请注意\"></a>有坑请注意</h3><p><strong>开启 opcache.revalidate_freq&#x3D;0 和 opcache.validate_timestamps&#x3D;0 后，OPCache 不会刷新缓存。意思就是说，再去改动项目中的文件，OPCache 不会重新缓存它！不慌 opcache_reset 函数可以清除 OPCache 缓存，把 opcache_reset 函数做成一个接口，在改动一下项目的 CI 每次先调用一下 opcache_reset 实现的接口即可。</strong></p>\n","feature":true,"text":"在 PHP 5.5 版本中引入的 OPCache，是 PHP 代码执行的重要组成部分。OPCache 是一个开源的 PHP 扩展，OPCache 的目地是避免重复编译，减少 CPU 和内存开销。，从而提高 PHP 脚本的性能和响应速度。...","permalink":"/post/PHP OPcache","photos":[],"count_time":{"symbolsCount":"2.3k","symbolsTime":"2 mins."},"categories":[],"tags":[{"name":"PHP","slug":"PHP","count":2,"path":"api/tags/PHP.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BB%80%E4%B9%88%E6%98%AF-OPCache%EF%BC%9F\"><span class=\"toc-text\">什么是 OPCache？</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#OPCache-%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86\"><span class=\"toc-text\">OPCache 的工作原理</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#OPCache-%E7%9A%84%E4%BC%98%E5%8A%BF\"><span class=\"toc-text\">OPCache 的优势</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%A6%82%E4%BD%95%E5%90%AF%E7%94%A8-OPCache%EF%BC%9F\"><span class=\"toc-text\">如何启用 OPCache？</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%AE%98%E6%96%B9%E6%8E%A8%E8%8D%90%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">官方推荐配置</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#Laravel-%E6%8E%A8%E8%8D%90%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">Laravel 推荐配置</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9C%89%E5%9D%91%E8%AF%B7%E6%B3%A8%E6%84%8F\"><span class=\"toc-text\">有坑请注意</span></a></li></ol>","author":{"name":"哪吒","slug":"blog-author","avatar":"https://pic.imgdb.cn/item/65ba193b871b83018a65323c.jpg","link":"/","description":"人心中的成见就像一座大山，任你怎么努力也休想搬动。","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{},"next_post":{"title":"Jenkins","uid":"338b1cc7dac7b8e70257391bd1fab1ed","slug":"Jenkins","date":"2024-02-27T05:04:16.000Z","updated":"2024-02-27T09:43:56.041Z","comments":true,"path":"api/articles/Jenkins.json","keywords":null,"cover":[],"text":"Jenkins 是一个开源的自动化服务器，用于实现持续集成和持续交付（CI/CD）流水线。它允许开发人员自动化软件开发过程中的各个环节，如构建、测试和部署应用程序。...","permalink":"/post/Jenkins","photos":[],"count_time":{"symbolsCount":"2.8k","symbolsTime":"3 mins."},"categories":[],"tags":[{"name":"Jenkins","slug":"Jenkins","count":1,"path":"api/tags/Jenkins.json"}],"author":{"name":"哪吒","slug":"blog-author","avatar":"https://pic.imgdb.cn/item/65ba193b871b83018a65323c.jpg","link":"/","description":"人心中的成见就像一座大山，任你怎么努力也休想搬动。","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true}}