{"title":"MySQL 读写分离","uid":"263e776b7c4ab948e2c3d7edc00d6223","slug":"MySQL-读写分离","date":"2024-02-26T12:27:04.000Z","updated":"2024-02-26T13:37:02.893Z","comments":true,"path":"api/articles/MySQL-读写分离.json","keywords":null,"cover":null,"content":"<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>💡 Tips：MySQL 读写分离是一种<strong>数据库架构设计模式</strong>，旨在<strong>提高数据库性能</strong>和<strong>可伸缩性</strong>。它通过将读请求和写请求分发到不同的数据库实例上来实现。</p></blockquote>\n<h3 id=\"基本原理\"><a href=\"#基本原理\" class=\"headerlink\" title=\"基本原理\"></a>基本原理</h3><ol>\n<li><strong>主数据库（Master）</strong>：负责处理所有的写操作（INSERT、UPDATE、DELETE），以保证数据的一致性和可靠性；</li>\n<li><strong>从数据库（Slave）</strong>：主要负责处理读操作（SELECT），它们的数据是通过主数据库同步复制过来的，因此数据一致性会有一定延迟；</li>\n</ol>\n<div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">TIP</p>\n<p>设置主从复制（Master-Slave Replication）：在 MySQL 中配置主数据库和从数据库。主数据库持续地将其写操作的日志传输给从数据库，从数据库则执行这些写操作，以保持数据的同步。<strong>从数据库的数据同步存在一定的延迟</strong>，因此需要考虑如何处理延迟带来的数据一致性问题。一般情况下，读操作可以容忍一定的延迟，但对于一些实时性要求较高的场景，需要进行特殊处理，比如：去主数据库读；</p>\n</div>\n<h3 id=\"实现的核心\"><a href=\"#实现的核心\" class=\"headerlink\" title=\"实现的核心\"></a>实现的核心</h3><p>Binlog 是 MySQL 中的二进制日志（Binary Log）的简称。它是 MySQL 数据库引擎记录数据库变更操作的一种方式。Binlog 记录了对数据库进行的所有修改，包括 <strong>DDL</strong>（数据定义语言）操作（如创建、修改和删除表格、<strong>索引</strong>等）和 <strong>DML</strong>（数据操作语言）操作（如插入、更新、删除等），<strong>以二进制的形式保存在文件中</strong>。二进制日志文件的内容是以二进制格式存储的，这些内容对普通用户来说是不可读的。但是，通过使用 <strong>mysqlbinlog</strong> 工具，可以将二进制日志文件转换成可读的文本格式，以便查看其内容：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysqlbinlog 二进制文件名.序列号 &gt; binlog.txt</span><br></pre></td></tr></table></figure>\n\n<p>Binlog 文件存储的内容大概如此：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">at 123</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">210225 12:34:56 server <span class=\"built_in\">id</span> 1  end_log_pos 234</span></span><br><span class=\"line\">BEGIN</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">at 234</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">210225 12:34:56 server <span class=\"built_in\">id</span> 1  end_log_pos 345</span></span><br><span class=\"line\">INSERT INTO `example_table` VALUES (1, &#x27;example_data&#x27;);</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">at 345</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">210225 12:34:56 server <span class=\"built_in\">id</span> 1  end_log_pos 456</span></span><br><span class=\"line\">COMMIT;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"主数据库配置\"><a href=\"#主数据库配置\" class=\"headerlink\" title=\"主数据库配置\"></a>主数据库配置</h3><h4 id=\"修改-MySQL-配置文件\"><a href=\"#修改-MySQL-配置文件\" class=\"headerlink\" title=\"修改 MySQL 配置文件\"></a>修改 MySQL 配置文件</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/mysql/my.cnf</span><br></pre></td></tr></table></figure>\n\n<div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">TIP</p>\n<p>Mysql 5.7.2 以后没有默认配置了，一切配置需要自行配置。</p>\n</div>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">server-id=1</span>              <span class=\"comment\"># 数据库唯一ID</span></span><br><span class=\"line\"><span class=\"string\">log-bin=mysql-bin</span>        <span class=\"comment\"># mysql-bin日志前缀，可自定义</span></span><br><span class=\"line\"><span class=\"string\">binlog-do-db=db1,db2</span>     <span class=\"comment\"># 需要同步的库</span></span><br><span class=\"line\"><span class=\"string\">binlog-ignore-db=db1,db2</span> <span class=\"comment\"># 忽略不同步的库</span></span><br></pre></td></tr></table></figure>\n\n<div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">TIP</p>\n<p>binlog 两个参数二选一 ，如果都不写，则全部同步。</p>\n</div>\n<h4 id=\"查询-bin-log-是否开启\"><a href=\"#查询-bin-log-是否开启\" class=\"headerlink\" title=\"查询 bin-log 是否开启\"></a>查询 bin-log 是否开启</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">show variables like <span class=\"string\">&#x27;%log_bin%&#x27;</span>;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">+---------------------------------+--------------------------------+</span></span><br><span class=\"line\"><span class=\"string\">|</span> <span class=\"string\">Variable_name</span>                   <span class=\"string\">|</span> <span class=\"string\">Value</span>                          <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">+---------------------------------+--------------------------------+</span></span><br><span class=\"line\"><span class=\"string\">|</span> <span class=\"string\">log_bin</span>                         <span class=\"string\">|</span> <span class=\"string\">ON</span>                             <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">|</span> <span class=\"string\">log_bin_basename</span>                <span class=\"string\">|</span> <span class=\"string\">/var/lib/mysql/mysql-bin</span>       <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">|</span> <span class=\"string\">log_bin_index</span>                   <span class=\"string\">|</span> <span class=\"string\">/var/lib/mysql/mysql-bin.index</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">|</span> <span class=\"string\">log_bin_trust_function_creators</span> <span class=\"string\">|</span> <span class=\"string\">OFF</span>                            <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">|</span> <span class=\"string\">log_bin_use_v1_row_events</span>       <span class=\"string\">|</span> <span class=\"string\">OFF</span>                            <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">|</span> <span class=\"string\">sql_log_bin</span>                     <span class=\"string\">|</span> <span class=\"string\">ON</span>                             <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">+---------------------------------+--------------------------------+</span></span><br><span class=\"line\"><span class=\"number\">6</span> <span class=\"string\">rows</span> <span class=\"string\">in</span> <span class=\"string\">set</span> <span class=\"string\">(0.01</span> <span class=\"string\">sec)</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"在主数据库上建立帐户并授权\"><a href=\"#在主数据库上建立帐户并授权\" class=\"headerlink\" title=\"在主数据库上建立帐户并授权\"></a>在主数据库上建立帐户并授权</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 以下为 5.x 版本 创建用户并且授权</span></span><br><span class=\"line\">grant replication slave  on *.*  to <span class=\"string\">&#x27;nezha&#x27;</span>@<span class=\"string\">&#x27;%&#x27;</span> identified by <span class=\"string\">&#x27;9527&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 以下为 8 版本 创建用户并且授权</span></span><br><span class=\"line\">create user ‘nezha’@‘%’ identified by ‘9527’;</span><br><span class=\"line\">grant all privileges on *.* to ‘nezha’@’%’ with grant option; </span><br><span class=\"line\">flush privileges;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"查看状态\"><a href=\"#查看状态\" class=\"headerlink\" title=\"查看状态\"></a>查看状态</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">show master status;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># File 和 Position 要记录好</span></span><br><span class=\"line\"><span class=\"string\">+------------------+----------+--------------+------------------+-------------------+</span></span><br><span class=\"line\"><span class=\"string\">|</span> <span class=\"string\">File</span>             <span class=\"string\">|</span> <span class=\"string\">Position</span> <span class=\"string\">|</span> <span class=\"string\">Binlog_Do_DB</span> <span class=\"string\">|</span> <span class=\"string\">Binlog_Ignore_DB</span> <span class=\"string\">|</span> <span class=\"string\">Executed_Gtid_Set</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">+------------------+----------+--------------+------------------+-------------------+</span></span><br><span class=\"line\"><span class=\"string\">|</span> <span class=\"string\">mysql-bin.000001</span> <span class=\"string\">|</span>      <span class=\"number\">155</span> <span class=\"string\">|</span> <span class=\"string\">dao</span>\t\t     <span class=\"string\">|</span>                  <span class=\"string\">|</span>                   <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">+------------------+----------+--------------+------------------+-------------------+</span></span><br><span class=\"line\"><span class=\"number\">1</span> <span class=\"string\">row</span> <span class=\"string\">in</span> <span class=\"string\">set</span> <span class=\"string\">(0.00</span> <span class=\"string\">sec)</span></span><br></pre></td></tr></table></figure>\n\n<div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">TIP</p>\n<ul>\n<li><code>File</code>：当前正在写入的二进制日志文件的名称；</li>\n<li><code>Position</code>：当前二进制日志文件中正在写入的位置（以字节为单位），即下一个待写入的位置；</li>\n<li><code>Binlog_Do_DB</code>：指定要写入二进制日志的数据库，即只记录与这些数据库相关的操作；</li>\n<li><code>Binlog_Ignore_DB</code>：指定不写入二进制日志的数据库，即忽略与这些数据库相关的操作；</li>\n<li><code>Executed_Gtid_Set</code>：已执行的全局事务标识符（GTID）集合，用于复制和恢复；</li>\n</ul>\n\n</div>\n<h3 id=\"从数据库配置\"><a href=\"#从数据库配置\" class=\"headerlink\" title=\"从数据库配置\"></a>从数据库配置</h3><h4 id=\"修改-MySQL-配置文件-1\"><a href=\"#修改-MySQL-配置文件-1\" class=\"headerlink\" title=\"修改 MySQL 配置文件\"></a>修改 MySQL 配置文件</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/mysql/my.cnf</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">server-id=2</span>         \t    <span class=\"comment\"># 数据库唯一ID</span></span><br><span class=\"line\"><span class=\"string\">log-bin=mysql-bin</span>    \t    <span class=\"comment\"># mysql-bin日志前缀</span></span><br><span class=\"line\"><span class=\"string\">replicate-do-db=db1,db2</span>\t\t<span class=\"comment\"># 复制指定的数据库</span></span><br><span class=\"line\"><span class=\"string\">replicate-ignore-db=db1,db2</span> <span class=\"comment\"># 忽略指定的数据库</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"进入数据库命令行执行\"><a href=\"#进入数据库命令行执行\" class=\"headerlink\" title=\"进入数据库命令行执行\"></a>进入数据库命令行执行</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">stop slave; </span><br><span class=\"line\"></span><br><span class=\"line\">CHANGE MASTER TO</span><br><span class=\"line\">  <span class=\"comment\"># 主服务器地址</span></span><br><span class=\"line\">  MASTER_HOST=<span class=\"string\">&#x27;192.168.1.6&#x27;</span>,</span><br><span class=\"line\">  <span class=\"comment\"># 主服务器账号</span></span><br><span class=\"line\">  MASTER_USER=<span class=\"string\">&#x27;nezha&#x27;</span>,</span><br><span class=\"line\">  <span class=\"comment\"># 主服务器密码</span></span><br><span class=\"line\">  MASTER_PASSWORD=<span class=\"string\">&#x27;9527&#x27;</span>,</span><br><span class=\"line\">  <span class=\"comment\"># 主服务器端口</span></span><br><span class=\"line\">  MASTER_PORT=3306,</span><br><span class=\"line\">  <span class=\"comment\"># 主服务器 binlog 日志文件名,对应的 show master status 的 File</span></span><br><span class=\"line\">  MASTER_LOG_FILE=<span class=\"string\">&#x27;mysql-bin.000001&#x27;</span>,</span><br><span class=\"line\">  <span class=\"comment\"># 主服务器日志记录起点位置，对应的  show master status 的 Position</span></span><br><span class=\"line\">  MASTER_LOG_POS=155,</span><br><span class=\"line\">  <span class=\"comment\"># 连接重试次数</span></span><br><span class=\"line\">  MASTER_CONNECT_RETRY=10;</span><br><span class=\"line\"></span><br><span class=\"line\">start slave;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"查看是否配置成功\"><a href=\"#查看是否配置成功\" class=\"headerlink\" title=\"查看是否配置成功\"></a>查看是否配置成功</h4><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">Slave_IO_Running:Yes</span> </span><br><span class=\"line\"><span class=\"string\">Slave_SQL_Running:Yes</span> </span><br></pre></td></tr></table></figure>\n\n<div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">TIP</p>\n<p>以上两个都为 yes 则表明成功，IO 表示此进程负责从服务器从主服务器上读取binlog 日志，并写入从服务器上的中继日志，SQL 表示此进程负责读取并且执行中继日志中的binlog日志。</p>\n</div>\n<h3 id=\"Laravel-实现读写分离\"><a href=\"#Laravel-实现读写分离\" class=\"headerlink\" title=\"Laravel 实现读写分离\"></a>Laravel 实现读写分离</h3><p>做为 PHP 的艺术家框架，Laravel 实现 MySQL 的读写分离非常的简单，只需要更改 database.php 配置文件即可：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">        <span class=\"string\">&#x27;mysql&#x27;</span> =&gt; [</span><br><span class=\"line\">            <span class=\"string\">&#x27;driver&#x27;</span> =&gt; <span class=\"string\">&#x27;mysql&#x27;</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;read&#x27;</span> =&gt; [</span><br><span class=\"line\">                <span class=\"string\">&#x27;host&#x27;</span> =&gt; <span class=\"string\">&#x27;192.168.1.6&#x27;</span>,</span><br><span class=\"line\">                <span class=\"string\">&#x27;password&#x27;</span> =&gt; <span class=\"title function_ invoke__\">env</span>(<span class=\"string\">&#x27;DB_READ_PASSWORD&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">            ],</span><br><span class=\"line\">            <span class=\"string\">&#x27;write&#x27;</span> =&gt; [</span><br><span class=\"line\">                <span class=\"string\">&#x27;host&#x27;</span> =&gt; <span class=\"string\">&#x27;192.168.1.6&#x27;</span>,</span><br><span class=\"line\">                <span class=\"string\">&#x27;password&#x27;</span> =&gt; <span class=\"title function_ invoke__\">env</span>(<span class=\"string\">&#x27;DB_WRITE_PASSWORD&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">            ],</span><br><span class=\"line\">            <span class=\"string\">&#x27;url&#x27;</span> =&gt; <span class=\"title function_ invoke__\">env</span>(<span class=\"string\">&#x27;DATABASE_URL&#x27;</span>),</span><br><span class=\"line\"><span class=\"comment\">//            &#x27;host&#x27; =&gt; env(&#x27;DB_HOST&#x27;, &#x27;127.0.0.1&#x27;),</span></span><br><span class=\"line\">            <span class=\"string\">&#x27;port&#x27;</span> =&gt; <span class=\"title function_ invoke__\">env</span>(<span class=\"string\">&#x27;DB_PORT&#x27;</span>, <span class=\"string\">&#x27;3306&#x27;</span>),</span><br><span class=\"line\">            <span class=\"string\">&#x27;database&#x27;</span> =&gt; <span class=\"title function_ invoke__\">env</span>(<span class=\"string\">&#x27;DB_DATABASE&#x27;</span>, <span class=\"string\">&#x27;forge&#x27;</span>),</span><br><span class=\"line\">            <span class=\"string\">&#x27;username&#x27;</span> =&gt; <span class=\"title function_ invoke__\">env</span>(<span class=\"string\">&#x27;DB_USERNAME&#x27;</span>, <span class=\"string\">&#x27;forge&#x27;</span>),</span><br><span class=\"line\"><span class=\"comment\">//            &#x27;password&#x27; =&gt; env(&#x27;DB_PASSWORD&#x27;, &#x27;&#x27;),</span></span><br><span class=\"line\">            <span class=\"string\">&#x27;unix_socket&#x27;</span> =&gt; <span class=\"title function_ invoke__\">env</span>(<span class=\"string\">&#x27;DB_SOCKET&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>),</span><br><span class=\"line\">            <span class=\"string\">&#x27;charset&#x27;</span> =&gt; <span class=\"string\">&#x27;utf8mb4&#x27;</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;collation&#x27;</span> =&gt; <span class=\"string\">&#x27;utf8mb4_unicode_ci&#x27;</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;prefix&#x27;</span> =&gt; <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;prefix_indexes&#x27;</span> =&gt; <span class=\"literal\">true</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;strict&#x27;</span> =&gt; <span class=\"literal\">true</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;engine&#x27;</span> =&gt; <span class=\"literal\">null</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;options&#x27;</span> =&gt; <span class=\"title function_ invoke__\">extension_loaded</span>(<span class=\"string\">&#x27;pdo_mysql&#x27;</span>) ? <span class=\"title function_ invoke__\">array_filter</span>([</span><br><span class=\"line\">                PDO::<span class=\"variable constant_\">MYSQL_ATTR_SSL_CA</span> =&gt; <span class=\"title function_ invoke__\">env</span>(<span class=\"string\">&#x27;MYSQL_ATTR_SSL_CA&#x27;</span>),</span><br><span class=\"line\">            ]) : [],</span><br><span class=\"line\">        ],</span><br></pre></td></tr></table></figure>\n\n<div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">TIP</p>\n<p>Laravel 的 MySQL 驱动是支持：一主多从或多主多从的，实际情况根据项目需求而定。</p>\n</div>\n","feature":true,"text":"MySQL 读写分离是一种数据库架构设计模式，旨在提高数据库性能和可伸缩性。它通过将读请求和写请求分发到不同的数据库实例上来实现。...","permalink":"/post/MySQL-读写分离","photos":[],"count_time":{"symbolsCount":"5.6k","symbolsTime":"5 mins."},"categories":[],"tags":[{"name":"MySQL","slug":"MySQL","count":1,"path":"api/tags/MySQL.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86\"><span class=\"toc-text\">基本原理</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AE%9E%E7%8E%B0%E7%9A%84%E6%A0%B8%E5%BF%83\"><span class=\"toc-text\">实现的核心</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%B8%BB%E6%95%B0%E6%8D%AE%E5%BA%93%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">主数据库配置</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E4%BF%AE%E6%94%B9-MySQL-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6\"><span class=\"toc-text\">修改 MySQL 配置文件</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%9F%A5%E8%AF%A2-bin-log-%E6%98%AF%E5%90%A6%E5%BC%80%E5%90%AF\"><span class=\"toc-text\">查询 bin-log 是否开启</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%9C%A8%E4%B8%BB%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8A%E5%BB%BA%E7%AB%8B%E5%B8%90%E6%88%B7%E5%B9%B6%E6%8E%88%E6%9D%83\"><span class=\"toc-text\">在主数据库上建立帐户并授权</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%9F%A5%E7%9C%8B%E7%8A%B6%E6%80%81\"><span class=\"toc-text\">查看状态</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BB%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">从数据库配置</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E4%BF%AE%E6%94%B9-MySQL-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-1\"><span class=\"toc-text\">修改 MySQL 配置文件</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E8%BF%9B%E5%85%A5%E6%95%B0%E6%8D%AE%E5%BA%93%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%89%A7%E8%A1%8C\"><span class=\"toc-text\">进入数据库命令行执行</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%9F%A5%E7%9C%8B%E6%98%AF%E5%90%A6%E9%85%8D%E7%BD%AE%E6%88%90%E5%8A%9F\"><span class=\"toc-text\">查看是否配置成功</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Laravel-%E5%AE%9E%E7%8E%B0%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB\"><span class=\"toc-text\">Laravel 实现读写分离</span></a></li></ol>","author":{"name":"哪吒","slug":"blog-author","avatar":"https://pic.imgdb.cn/item/65ba193b871b83018a65323c.jpg","link":"/","description":"人心中的成见就像一座大山，任你怎么努力也休想搬动。","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"Git","uid":"221a7ad001c03569112f684b2dfdc120","slug":"Git","date":"2024-02-26T13:42:40.000Z","updated":"2024-02-26T14:53:10.789Z","comments":true,"path":"api/articles/Git.json","keywords":null,"cover":null,"text":"git 是一个开源的分布式版本控制系统，可以有效、高速地处理从很小到非常大的项目版本管理。...","permalink":"/post/Git","photos":[],"count_time":{"symbolsCount":"2.8k","symbolsTime":"3 mins."},"categories":[],"tags":[{"name":"Git","slug":"Git","count":1,"path":"api/tags/Git.json"}],"author":{"name":"哪吒","slug":"blog-author","avatar":"https://pic.imgdb.cn/item/65ba193b871b83018a65323c.jpg","link":"/","description":"人心中的成见就像一座大山，任你怎么努力也休想搬动。","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"RSA 非对称加密","uid":"bed83d6062569a837b3fdb59545fa846","slug":"RSA-非对称加密","date":"2024-02-26T11:53:22.000Z","updated":"2024-02-26T12:00:58.044Z","comments":true,"path":"api/articles/RSA-非对称加密.json","keywords":null,"cover":null,"text":"RSA 加密是一种非对称加密算法，使用一对密钥进行加解密，分别为公钥和私钥。公钥用于加密信息，私钥用于解密信息。这种设置使得发送者可以使用公钥加密信息并发送给接收者，而只有接收者持有相应私钥才能解密并读取信息。...","permalink":"/post/RSA-非对称加密","photos":[],"count_time":{"symbolsCount":"25k","symbolsTime":"23 mins."},"categories":[],"tags":[{"name":"加密算法","slug":"加密算法","count":1,"path":"api/tags/加密算法.json"}],"author":{"name":"哪吒","slug":"blog-author","avatar":"https://pic.imgdb.cn/item/65ba193b871b83018a65323c.jpg","link":"/","description":"人心中的成见就像一座大山，任你怎么努力也休想搬动。","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true}}