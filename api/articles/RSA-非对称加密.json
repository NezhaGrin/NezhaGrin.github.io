{"title":"RSA éå¯¹ç§°åŠ å¯†","uid":"bed83d6062569a837b3fdb59545fa846","slug":"RSA-éå¯¹ç§°åŠ å¯†","date":"2024-02-26T11:53:22.000Z","updated":"2024-02-26T12:00:58.044Z","comments":true,"path":"api/articles/RSA-éå¯¹ç§°åŠ å¯†.json","keywords":null,"cover":null,"content":"<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>ğŸ’¡ Tipsï¼šRSA åŠ å¯†æ˜¯ä¸€ç§<strong>éå¯¹ç§°åŠ å¯†ç®—æ³•</strong>ï¼Œä½¿ç”¨<strong>ä¸€å¯¹å¯†é’¥</strong>è¿›è¡ŒåŠ è§£å¯†ï¼Œåˆ†åˆ«ä¸ºå…¬é’¥å’Œç§é’¥ã€‚<strong>å…¬é’¥ç”¨äºåŠ å¯†ä¿¡æ¯</strong>ï¼Œ<strong>ç§é’¥ç”¨äºè§£å¯†ä¿¡æ¯</strong>ã€‚è¿™ç§è®¾ç½®ä½¿å¾—å‘é€è€…å¯ä»¥ä½¿ç”¨å…¬é’¥åŠ å¯†ä¿¡æ¯å¹¶å‘é€ç»™æ¥æ”¶è€…ï¼Œè€Œåªæœ‰æ¥æ”¶è€…æŒæœ‰ç›¸åº”ç§é’¥æ‰èƒ½è§£å¯†å¹¶è¯»å–ä¿¡æ¯ã€‚</p>\n<p>RSA åŠ è§£å¯†çš„æ ¸å¿ƒæ˜¯åŸºäº<strong>ç´ æ•°ï¼ˆåªèƒ½è¢« 1 å’Œå®ƒè‡ªèº«æ•´é™¤çš„æ•°ï¼‰</strong>çš„ç®—æ³•ï¼Œå¦‚æœæ²¡æœ‰ä¸€ä¸ªå¥½çš„ç®—æ³•ï¼Œé‚£ä¹ˆåŠ è§£å¯†æ•ˆç‡éå¸¸ä½ï¼å·¥ä½œä¸­ç§»æ¤è¿‡ CycloneSSH çš„ <a href=\"https://github.com/Oryx-Embedded/CycloneCRYPTO/blob/49578a0662438af04bd151c6dbe6a603e7e4f5b5/pkc/rsa.c#L2065\">ssh-keygen</a> ç”Ÿæˆå…¬é’¥ç§é’¥æ•ˆç‡æä½ï¼Œå°±æ˜¯å› ä¸ºæ²¡æœ‰ä¸€ä¸ªå¥½çš„ç´ æ•°ç®—æ³•ã€‚</p>\n<p>éšç€ç°åœ¨è®¡ç®—æœºçš„è®¡ç®—èƒ½åŠ›æå‡å’Œå¯†ç åˆ†ææŠ€æœ¯çš„è¿›æ­¥ï¼Œ1024 é•¿åº¦çš„ rsa åŠ å¯†å·²ç»ä¸å®‰å…¨äº†ï¼Œå› æ­¤åœ¨ä½¿ç”¨æ—¶éœ€è¦è°¨æ…è€ƒè™‘å¯†é’¥é•¿åº¦å’Œç®—æ³•çš„é€‰æ‹©ã€‚</p></blockquote>\n<h3 id=\"éå¯¹ç§°ä¸å¯¹ç§°åŠ å¯†\"><a href=\"#éå¯¹ç§°ä¸å¯¹ç§°åŠ å¯†\" class=\"headerlink\" title=\"éå¯¹ç§°ä¸å¯¹ç§°åŠ å¯†\"></a>éå¯¹ç§°ä¸å¯¹ç§°åŠ å¯†</h3><p>å½“æˆ‘ä»¬è®¨è®ºåŠ å¯†æ—¶ï¼Œé€šå¸¸ä¼šæ¶‰åŠä¸¤ç§ä¸»è¦ç±»å‹ï¼šéå¯¹ç§°åŠ å¯†å’Œå¯¹ç§°åŠ å¯†ã€‚</p>\n<h4 id=\"éå¯¹ç§°åŠ å¯†\"><a href=\"#éå¯¹ç§°åŠ å¯†\" class=\"headerlink\" title=\"éå¯¹ç§°åŠ å¯†\"></a>éå¯¹ç§°åŠ å¯†</h4><p>éå¯¹ç§°åŠ å¯†ä½¿ç”¨<strong>ä¸€å¯¹å¯†é’¥</strong>ï¼Œåˆ†åˆ«ç§°ä¸ºå…¬é’¥å’Œç§é’¥ã€‚å…¬é’¥ç”¨äºåŠ å¯†æ•°æ®ï¼Œè€Œç§é’¥ç”¨äºè§£å¯†æ•°æ®ã€‚å…¬é’¥æ˜¯å…¬å¼€çš„ï¼Œä»»ä½•äººéƒ½å¯ä»¥ä½¿ç”¨å®ƒæ¥åŠ å¯†æ•°æ®ã€‚ç§é’¥åˆ™ç”±æ•°æ®çš„æ¥æ”¶è€…ä¿å¯†ï¼Œç”¨äºè§£å¯†æ•°æ®ã€‚</p>\n<div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">TIP</p>\n<p>å¸¸è§çš„éå¯¹ç§°åŠ å¯†ç®—æ³•æ˜¯ RSAï¼ˆRivest-Shamir-Adlemanï¼‰ï¼Œéå¯¹ç§°åŠ å¯†é€‚ç”¨äº<strong>éœ€è¦å®‰å…¨é€šä¿¡ã€æ•°å­—ç­¾åå’Œèº«ä»½éªŒè¯</strong>ç­‰åœºæ™¯ã€‚</p>\n</div>\n<h4 id=\"éå¯¹ç§°åŠ å¯†çš„åº”ç”¨åœºæ™¯\"><a href=\"#éå¯¹ç§°åŠ å¯†çš„åº”ç”¨åœºæ™¯\" class=\"headerlink\" title=\"éå¯¹ç§°åŠ å¯†çš„åº”ç”¨åœºæ™¯\"></a>éå¯¹ç§°åŠ å¯†çš„åº”ç”¨åœºæ™¯</h4><ul>\n<li><strong>å®‰å…¨é€šä¿¡</strong>ï¼šéå¯¹ç§°åŠ å¯†å¸¸ç”¨äºå®‰å…¨é€šä¿¡ï¼Œå¦‚ç”µå­é‚®ä»¶ã€æ–‡ä»¶ä¼ è¾“ç­‰ã€‚å‘é€è€…ä½¿ç”¨æ¥æ”¶è€…çš„å…¬é’¥æ¥åŠ å¯†æ•°æ®ï¼Œè€Œåªæœ‰æ¥æ”¶è€…æ‹¥æœ‰ç›¸åº”çš„ç§é’¥æ‰èƒ½è§£å¯†æ•°æ®ï¼›</li>\n<li><strong>æ•°å­—ç­¾å</strong>ï¼šéå¯¹ç§°åŠ å¯†å¯ç”¨äºç”Ÿæˆå’ŒéªŒè¯æ•°å­—ç­¾åï¼Œä»¥ç¡®ä¿æ•°æ®çš„çœŸå®æ€§å’Œå®Œæ•´æ€§ã€‚å‘é€è€…ä½¿ç”¨è‡ªå·±çš„ç§é’¥æ¥å¯¹æ•°æ®è¿›è¡Œç­¾åï¼Œè€Œæ¥æ”¶è€…å¯ä»¥ä½¿ç”¨å‘é€è€…çš„å…¬é’¥æ¥éªŒè¯ç­¾åï¼›</li>\n<li><strong>å¯†é’¥äº¤æ¢</strong>ï¼šéå¯¹ç§°åŠ å¯†å¯ç”¨äºå®‰å…¨åœ°äº¤æ¢å¯¹ç§°åŠ å¯†å¯†é’¥ã€‚ä¾‹å¦‚ï¼ŒDiffie-Hellmanï¼ˆSSHåè®®ï¼‰ å¯†é’¥äº¤æ¢åè®®ä½¿ç”¨éå¯¹ç§°åŠ å¯†ç®—æ³•æ¥åå•†å¯¹ç§°å¯†é’¥ï¼Œä»è€Œå®ç°å®‰å…¨é€šä¿¡ï¼›</li>\n<li><strong>èº«ä»½éªŒè¯</strong>ï¼šéå¯¹ç§°åŠ å¯†å¯ç”¨äºç”¨æˆ·èº«ä»½éªŒè¯ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨å…¶ç§é’¥æ¥ç”Ÿæˆæ•°å­—ç­¾åï¼Œä»¥è¯æ˜å…¶èº«ä»½ã€‚ï¼›</li>\n</ul>\n<h4 id=\"å¯¹ç§°åŠ å¯†\"><a href=\"#å¯¹ç§°åŠ å¯†\" class=\"headerlink\" title=\"å¯¹ç§°åŠ å¯†\"></a>å¯¹ç§°åŠ å¯†</h4><p>å¯¹ç§°åŠ å¯†ä½¿ç”¨<strong>ç›¸åŒçš„å¯†é’¥</strong>ï¼ˆä¹Ÿç§°ä¸ºâ€œç§˜å¯†å¯†é’¥â€ï¼‰æ¥åŠ å¯†å’Œè§£å¯†æ•°æ®ã€‚è¿™æ„å‘³ç€å‘é€è€…å’Œæ¥æ”¶è€…å¿…é¡»äº‹å…ˆå…±äº«ç›¸åŒçš„å¯†é’¥ã€‚åœ¨åŠ å¯†æ—¶ï¼Œå‘é€è€…ä½¿ç”¨å¯†é’¥å°†æ˜æ–‡è½¬æ¢ä¸ºå¯†æ–‡ã€‚ç„¶åï¼Œæ¥æ”¶è€…ä½¿ç”¨ç›¸åŒçš„å¯†é’¥å°†å¯†æ–‡è§£å¯†ä¸ºæ˜æ–‡ã€‚</p>\n<div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">TIP</p>\n<p>å¸¸è§çš„å¯¹ç§°åŠ å¯†ç®—æ³•åŒ…æ‹¬ AESï¼ˆé«˜çº§åŠ å¯†æ ‡å‡†ï¼‰å’Œ DESï¼ˆæ•°æ®åŠ å¯†æ ‡å‡†ï¼‰ç­‰ã€‚å¯¹ç§°åŠ å¯†é€‚ç”¨äº<strong>éœ€è¦é«˜æ•ˆåŠ å¯†å¤§é‡æ•°æ®</strong>çš„åœºæ™¯ã€‚</p>\n</div>\n<h4 id=\"å¯¹ç§°åŠ å¯†åº”ç”¨åœºæ™¯\"><a href=\"#å¯¹ç§°åŠ å¯†åº”ç”¨åœºæ™¯\" class=\"headerlink\" title=\"å¯¹ç§°åŠ å¯†åº”ç”¨åœºæ™¯\"></a>å¯¹ç§°åŠ å¯†åº”ç”¨åœºæ™¯</h4><ul>\n<li><strong>æ•°æ®ä¼ è¾“åŠ å¯†</strong>ï¼šå¯¹ç§°åŠ å¯†å¸¸ç”¨äºä¿æŠ¤æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­çš„å®‰å…¨æ€§ã€‚ä¾‹å¦‚ï¼ŒHTTPS åè®®å°±ä½¿ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•æ¥åŠ å¯†æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­çš„é€šä¿¡å†…å®¹ï¼›</li>\n<li><strong>æ•°æ®å­˜å‚¨åŠ å¯†</strong>ï¼šå¯¹ç§°åŠ å¯†å¯ä»¥ç”¨äºä¿æŠ¤æ•°æ®åœ¨å­˜å‚¨ä»‹è´¨ä¸Šçš„å®‰å…¨æ€§ã€‚ä¾‹å¦‚ï¼ŒåŠ å¯†æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚ BitLockerï¼‰ä½¿ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•æ¥åŠ å¯†å­˜å‚¨åœ¨ç¡¬ç›˜ä¸Šçš„æ•°æ®ï¼›</li>\n<li><strong>ä¼šè¯åŠ å¯†</strong>ï¼šå¯¹ç§°åŠ å¯†å¯ç”¨äºä¿æŠ¤ç½‘ç»œä¼šè¯çš„å®‰å…¨æ€§ã€‚ä¾‹å¦‚ï¼Œå¸¸è§çš„ TLS&#x2F;SSL åè®®ä½¿ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•æ¥åŠ å¯†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ä¼šè¯ï¼›</li>\n<li><strong>å¯†ç å­¦åº”ç”¨</strong>ï¼šå¯¹ç§°åŠ å¯†å¯ç”¨äºå¯†ç å­¦åº”ç”¨ï¼Œå¦‚æ¶ˆæ¯è®¤è¯ç ï¼ˆMACï¼‰çš„ç”Ÿæˆå’ŒéªŒè¯ï¼Œä»¥ç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§ï¼›</li>\n</ul>\n<h3 id=\"ç”Ÿæˆç§˜é’¥å¯¹\"><a href=\"#ç”Ÿæˆç§˜é’¥å¯¹\" class=\"headerlink\" title=\"ç”Ÿæˆç§˜é’¥å¯¹\"></a>ç”Ÿæˆç§˜é’¥å¯¹</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç¬¬ä¸€æ­¥ï¼šç”Ÿæˆç§é’¥ï¼Œè¿™é‡Œæˆ‘ä»¬æŒ‡å®šç§é’¥çš„é•¿åº¦ä¸º1024, é•¿åº¦è¶Šé•¿ï¼ŒåŠ è§£å¯†æ¶ˆè€—çš„æ—¶é—´è¶Šé•¿</span></span><br><span class=\"line\">openssl genrsa -out rsa_private_key.pem 1024</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç¬¬äºŒæ­¥ï¼šæ ¹æ®ç§é’¥ç”Ÿæˆå¯¹åº”çš„å…¬é’¥</span></span><br><span class=\"line\">openssl rsa -<span class=\"keyword\">in</span> rsa_private_key.pem -pubout -out rsa_public_key.pub</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç¬¬ä¸‰æ­¥ï¼šç§é’¥è½¬åŒ–æˆpkcs8æ ¼å¼ï¼Œã€è¿™ä¸€æ­¥éå¿…é¡»ï¼Œåªæ˜¯ç¨‹åºè§£æèµ·æ¥æ–¹ä¾¿ã€‘</span></span><br><span class=\"line\">openssl pkcs8 -topk8 -inform PEM -<span class=\"keyword\">in</span> rsa_private_key.pem -outform PEM -nocrypt -out rsa_private_key_pkcs8.pem</span><br></pre></td></tr></table></figure>\n\n<div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">TIP</p>\n<ul>\n<li>Linux éœ€å®‰è£… OpenSSHï¼šsudo apt-get install openssh-serverï¼›</li>\n<li>Windows 10 ä»¥åŠä»¥ä¸Šçš„ç‰ˆæœ¬è‡ªå¸¦ SSH å®¢æˆ·ç«¯ï¼Œå…¶ä»–ç‰ˆæœ¬å¯ä»¥ç¬¬ä¸‰æ–¹å·¥å…·ä½¿ç”¨ SSH å®¢æˆ·ç«¯ï¼›</li>\n</ul>\n\n</div>\n<h3 id=\"PHP-RSA-åŠ è§£å¯†\"><a href=\"#PHP-RSA-åŠ è§£å¯†\" class=\"headerlink\" title=\"PHP RSA åŠ è§£å¯†\"></a>PHP RSA åŠ è§£å¯†</h3><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">namespace</span> <span class=\"title class_\">App</span>\\<span class=\"title class_\">Services</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SignService</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"variable\">$publicKey</span>;</span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"variable\">$privateKey</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * åˆå§‹åŒ–</span></span><br><span class=\"line\"><span class=\"comment\">     * */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;publicKey  = <span class=\"title function_ invoke__\">openssl_get_publickey</span>(<span class=\"title function_ invoke__\">file_get_contents</span>(<span class=\"string\">&#x27;../rsa_public_key.pub&#x27;</span>));</span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;privateKey = <span class=\"title function_ invoke__\">openssl_get_privatekey</span>(<span class=\"title function_ invoke__\">file_get_contents</span>(<span class=\"string\">&#x27;../rsa_private_key_pkcs8.pem&#x27;</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * å…¬é’¥åŠ å¯†</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> mixed $data</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">encrypt</span>(<span class=\"params\"><span class=\"variable\">$data</span></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$encrypt</span> = <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> (<span class=\"title function_ invoke__\">str_split</span>(<span class=\"variable\">$data</span>, <span class=\"number\">117</span>) <span class=\"keyword\">as</span> <span class=\"variable\">$item</span>)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"variable\">$temp</span> = <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">            <span class=\"title function_ invoke__\">openssl_public_encrypt</span>(<span class=\"variable\">$item</span>, <span class=\"variable\">$encrypt</span>, <span class=\"variable\">$this</span>-&gt;publicKey);</span><br><span class=\"line\">            <span class=\"variable\">$encrypt</span> .= <span class=\"variable\">$temp</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"title function_ invoke__\">openssl_free_key</span>(<span class=\"variable\">$this</span>-&gt;publicKey);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">base64_encode</span>(<span class=\"variable\">$encrypt</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * ç§é’¥è§£å¯†</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> mixed $data</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">decrypt</span>(<span class=\"params\"><span class=\"variable\">$data</span></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$data</span>    = <span class=\"title function_ invoke__\">base64_decode</span>(<span class=\"variable\">$data</span>);</span><br><span class=\"line\">        <span class=\"variable\">$decrypt</span> = <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> (<span class=\"title function_ invoke__\">str_split</span>(<span class=\"variable\">$data</span>, <span class=\"number\">128</span>) <span class=\"keyword\">as</span> <span class=\"variable\">$item</span>)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"variable\">$temp</span> = <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">            <span class=\"title function_ invoke__\">openssl_private_decrypt</span>(<span class=\"variable\">$item</span>, <span class=\"variable\">$temp</span>, <span class=\"variable\">$this</span>-&gt;privateKey);</span><br><span class=\"line\">            <span class=\"variable\">$decrypt</span> .= <span class=\"variable\">$temp</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"title function_ invoke__\">openssl_free_key</span>(<span class=\"variable\">$this</span>-&gt;privateKey);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable\">$decrypt</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * ç§é’¥ç”Ÿæˆç­¾å</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> mixed $data</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> string</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sign</span>(<span class=\"params\"><span class=\"variable\">$data</span></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$signature</span> = <span class=\"title function_ invoke__\">config</span>(<span class=\"string\">&#x27;app.signature&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"title function_ invoke__\">openssl_sign</span>(<span class=\"variable\">$data</span>, <span class=\"variable\">$signature</span>, <span class=\"variable\">$this</span>-&gt;privateKey);</span><br><span class=\"line\">        <span class=\"title function_ invoke__\">openssl_free_key</span>(<span class=\"variable\">$this</span>-&gt;privateKey);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"title function_ invoke__\">base64_encode</span>(<span class=\"variable\">$signature</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * å…¬é’¥éªŒè¯</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> mixed $data</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> mixed $sign</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> bool</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">veritySign</span>(<span class=\"params\"><span class=\"variable\">$data</span>,<span class=\"variable\">$sign</span></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$result</span> = <span class=\"title function_ invoke__\">openssl_verify</span>(<span class=\"variable\">$data</span>, <span class=\"title function_ invoke__\">base64_decode</span>(<span class=\"variable\">$sign</span>), <span class=\"variable\">$this</span>-&gt;publicKey);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"title function_ invoke__\">openssl_free_key</span>(<span class=\"variable\">$this</span>-&gt;publicKey);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> (<span class=\"keyword\">bool</span>)<span class=\"variable\">$result</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">TIP</p>\n<p>PHP è¦æ“ä½œ RSA éœ€è¦ç”¨åˆ° OpenSSL æ‰©å±•åº“ï¼Œå¦å¤–éœ€è¦æ³¨æ„ï¼šRSA åŠ å¯†é‡‡ç”¨äº†<strong>åˆ†å—</strong>è¿›è¡ŒåŠ å¯†ï¼Œå› æ­¤æœ‰é•¿åº¦é™åˆ¶ã€‚å¯¹äºè¾ƒé•¿çš„åŸæ–‡ï¼Œéœ€è¦è¿›è¡Œåˆ†æ®µåŠ è§£å¯†ï¼Œåˆ†åˆ«å¯¹æ¯ä¸ªåˆ†æ®µè¿›è¡ŒåŠ å¯†ï¼ˆ117ï¼‰æˆ–è§£å¯†ï¼ˆ128ï¼‰ï¼Œç„¶åå†åˆå¹¶ç»“æœã€‚è¿™ç§æ–¹å¼å¯ä»¥å…‹æœ RSA åŠ å¯†é•¿åº¦çš„é™åˆ¶ï¼Œä½†ä¼šå‡ºç°æ•ˆç‡é—®é¢˜ï¼Œå› ä¸ºåˆ†æ®µåŠ è§£å¯†å¯èƒ½ä¼šå¯¼è‡´é¢å¤–çš„è®¡ç®—å¼€é”€ã€‚</p>\n</div>\n<h3 id=\"ç§»æ¤-ssh-keygen-å®¢æˆ·ç«¯\"><a href=\"#ç§»æ¤-ssh-keygen-å®¢æˆ·ç«¯\" class=\"headerlink\" title=\"ç§»æ¤ ssh-keygen å®¢æˆ·ç«¯\"></a>ç§»æ¤ ssh-keygen å®¢æˆ·ç«¯</h3><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// libc ä¾èµ–</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;unistd.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;sys/stat.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;time.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// cyclone ä¾èµ–</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;path.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;pkc/rsa.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;rng/trng.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;rng/yarrow.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;ssh/ssh_key_export.h&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// éšæœºæ•°ç§å­</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> SEED_SIZE 32</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// rsa æ”¯æŒçš„é•¿åº¦</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> MIN_SUPPORT_BYTES 2048</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> MAX_SUPPORT_BYTES 16384</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// é»˜è®¤ ssh å­˜æ”¾è·¯å¾„</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> SSH_PATH <span class=\"string\">&quot;/ssh&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// æ¿å­ä¸Šç»ˆç«¯æœ€å¤šåªèƒ½è¾“å…¥ 120 å·¦å³ä¸ªå­—ç¬¦</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> MAX_KEY_LEN 255</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Yarrow PRNG ä¸Šä¸‹æ–‡</span></span><br><span class=\"line\">YarrowContext yarrowContext;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * @brief ç¬¦å·è¡¨</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"type\">const</span> <span class=\"type\">char</span> *symbolArray[] = &#123;<span class=\"string\">&quot;.&quot;</span>, <span class=\"string\">&quot;./&quot;</span>, <span class=\"string\">&quot;..&quot;</span>, <span class=\"string\">&quot;../&quot;</span>, <span class=\"string\">&quot;/&quot;</span>&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * @brief çŠ¶æ€</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">enum</span> <span class=\"title\">state</span> &#123;</span></span><br><span class=\"line\">    HELP,</span><br><span class=\"line\">    FAILED_BIT_SIZE,</span><br><span class=\"line\">    FAILED_BIT_TYPE</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * @brief ç”Ÿæˆå‚æ•°</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">GenerateParam</span> &#123;</span></span><br><span class=\"line\">    <span class=\"type\">size_t</span> bitSize;</span><br><span class=\"line\">    <span class=\"type\">char_t</span> *filename;</span><br><span class=\"line\">    <span class=\"type\">char_t</span> *algorithm;</span><br><span class=\"line\">&#125; generateParam;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * @brief æ‰“å°ä¿¡æ¯</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * @param[in] code  çŠ¶æ€ç </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"type\">static</span> <span class=\"type\">void</span> <span class=\"title function_\">printUsage</span><span class=\"params\">(<span class=\"type\">int_t</span> code)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (code) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> HELP:</span><br><span class=\"line\">            <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;usage: ssh-keygen [OPTIONS] &lt;file&gt;...\\n\\n&quot;</span>);</span><br><span class=\"line\">            <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;OPTIONS: [-b bits] [-f output_keyfile] [-t dsa | ecdsa | ed25519 | rsa]\\n\\n&quot;</span>);</span><br><span class=\"line\">            <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;-b &lt;bits&gt; Specify the key length \\n&quot;</span>);</span><br><span class=\"line\">            <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;-f &lt;output_keyfile&gt; Specifies the file name to save the key \\n&quot;</span>);</span><br><span class=\"line\">            <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;-t Specifies the type of key to create \\&quot;Only RSA is supported\\&quot; \\n&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> FAILED_BIT_SIZE:</span><br><span class=\"line\">            <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;The key length is 2048 range 16384 \\n&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> FAILED_BIT_TYPE:</span><br><span class=\"line\">            <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Bits value invalid \\n&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">exit</span>(code);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * @brief å†™å…¥ç”Ÿæˆçš„è¯ä¹¦ç§˜é’¥</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * @param[in] certPublicKey  å…¬é’¥</span></span><br><span class=\"line\"><span class=\"comment\"> * @param[in] certPrivateKey ç§é’¥</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"type\">static</span> <span class=\"type\">void</span> <span class=\"title function_\">writeGenerateCertKeys</span><span class=\"params\">(<span class=\"type\">const</span> <span class=\"type\">char_t</span> *certPublicKey, <span class=\"type\">const</span> <span class=\"type\">char_t</span> *certPrivateKey)</span> &#123;</span><br><span class=\"line\">    FILE *pubFile, *priFile;</span><br><span class=\"line\">    <span class=\"type\">char_t</span> pubKeyPath[MAX_KEY_LEN];</span><br><span class=\"line\">    <span class=\"type\">char_t</span> priKeyPath[MAX_KEY_LEN];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (generateParam.algorithm == <span class=\"literal\">NULL</span>) &#123;</span><br><span class=\"line\">        generateParam.algorithm = <span class=\"string\">&quot;rsa&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (generateParam.filename == <span class=\"literal\">NULL</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (access(SSH_PATH, F_OK) != <span class=\"number\">0</span> &amp;&amp; mkdir(SSH_PATH, <span class=\"number\">0777</span>) != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Saving key \\&quot;%s\\&quot; failed: No such file or directory\\n&quot;</span>, SSH_PATH);</span><br><span class=\"line\">            <span class=\"built_in\">exit</span>(ERROR_DIRECTORY_NOT_FOUND);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">snprintf</span>(pubKeyPath, MAX_KEY_LEN, <span class=\"string\">&quot;%s%s%s%s&quot;</span>, SSH_PATH, <span class=\"string\">&quot;/id_&quot;</span>, generateParam.algorithm, <span class=\"string\">&quot;.pub&quot;</span>);</span><br><span class=\"line\">        <span class=\"built_in\">snprintf</span>(priKeyPath, MAX_KEY_LEN, <span class=\"string\">&quot;%s%s%s&quot;</span>, SSH_PATH, <span class=\"string\">&quot;/id_&quot;</span>, generateParam.algorithm);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">uint_t</span> isSymbolTableMatched = FALSE;</span><br><span class=\"line\">        <span class=\"type\">const</span> <span class=\"type\">char_t</span> *filename = pathGetFilename(generateParam.filename);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">uint_t</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">5</span>; ++i) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (osStrcmp(filename, symbolArray[i]) == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                isSymbolTableMatched = TRUE;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        pathRemoveSlash(generateParam.filename);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (isSymbolTableMatched) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">snprintf</span>(pubKeyPath, MAX_KEY_LEN, <span class=\"string\">&quot;%s%s%s%s&quot;</span>, generateParam.filename, <span class=\"string\">&quot;/id_&quot;</span>, generateParam.algorithm, <span class=\"string\">&quot;.pub&quot;</span>);</span><br><span class=\"line\">            <span class=\"built_in\">snprintf</span>(priKeyPath, MAX_KEY_LEN, <span class=\"string\">&quot;%s%s%s&quot;</span>, generateParam.filename, <span class=\"string\">&quot;/id_&quot;</span>, generateParam.algorithm);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">snprintf</span>(pubKeyPath, MAX_KEY_LEN, <span class=\"string\">&quot;%s%s&quot;</span>, generateParam.filename, <span class=\"string\">&quot;.pub&quot;</span>);</span><br><span class=\"line\">            <span class=\"built_in\">snprintf</span>(priKeyPath, MAX_KEY_LEN, <span class=\"string\">&quot;%s&quot;</span>, generateParam.filename);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((pubFile = fopen(pubKeyPath, <span class=\"string\">&quot;w+&quot;</span>)) == <span class=\"literal\">NULL</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Saving key \\&quot;%s\\&quot; failed: No such file or directory\\n&quot;</span>, pubKeyPath);</span><br><span class=\"line\">        <span class=\"built_in\">exit</span>(ERROR_FILE_OPENING_FAILED);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((priFile = fopen(priKeyPath, <span class=\"string\">&quot;w+&quot;</span>)) == <span class=\"literal\">NULL</span>) &#123;</span><br><span class=\"line\">        fclose(pubFile);</span><br><span class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Saving key \\&quot;%s\\&quot; failed: No such file or directory\\n&quot;</span>, priKeyPath);</span><br><span class=\"line\">        <span class=\"built_in\">exit</span>(ERROR_FILE_OPENING_FAILED);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">size_t</span> rc1 = fwrite(certPublicKey, <span class=\"keyword\">sizeof</span>(<span class=\"type\">char_t</span>), osStrlen(certPublicKey), pubFile);</span><br><span class=\"line\">    <span class=\"type\">size_t</span> rc2 = fwrite(certPrivateKey, <span class=\"keyword\">sizeof</span>(<span class=\"type\">char_t</span>), osStrlen(certPrivateKey), priFile);</span><br><span class=\"line\"></span><br><span class=\"line\">    fclose(pubFile);</span><br><span class=\"line\">    fclose(priFile);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * @brief rsa è¯ä¹¦ç”Ÿæˆ</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * @return Error Code</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"type\">static</span> <span class=\"type\">error_t</span> <span class=\"title function_\">generateRsaCertKeys</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">error_t</span> error;</span><br><span class=\"line\"></span><br><span class=\"line\">    RsaPublicKey publicKey;</span><br><span class=\"line\">    RsaPrivateKey privateKey;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">size_t</span> bitSize = generateParam.bitSize ?: MIN_SUPPORT_BYTES;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">char_t</span> certPublicKey[bitSize];</span><br><span class=\"line\">    <span class=\"type\">char_t</span> certPrivateKey[bitSize];</span><br><span class=\"line\"></span><br><span class=\"line\">    rsaInitPublicKey(&amp;publicKey);</span><br><span class=\"line\">    rsaInitPrivateKey(&amp;privateKey);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((error = rsaGenerateKeyPair(YARROW_PRNG_ALGO, &amp;yarrowContext, bitSize, <span class=\"number\">65537</span>, &amp;privateKey, &amp;publicKey))) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Failed RSA key pair generation\\r\\n&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">goto</span> response;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((error = sshExportRsaPublicKey(&amp;publicKey, certPublicKey, &amp;bitSize, SSH_PUBLIC_KEY_FORMAT_OPENSSH))) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Failed Export an RSA public key to PEM format&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">goto</span> response;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((error = sshExportRsaPrivateKey(&amp;privateKey, &amp;publicKey, certPrivateKey, &amp;bitSize, SSH_PRIVATE_KEY_FORMAT_OPENSSH))) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Failed Export an RSA private key to PEM format\\r\\n&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">goto</span> response;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    writeGenerateCertKeys(certPublicKey, certPrivateKey);</span><br><span class=\"line\"></span><br><span class=\"line\">    response:</span><br><span class=\"line\"></span><br><span class=\"line\">    rsaFreePublicKey(&amp;publicKey);</span><br><span class=\"line\">    rsaFreePrivateKey(&amp;privateKey);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> error;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * @brief ssh-keygen</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * @return Unused value</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"type\">int_t</span> <span class=\"title function_\">main</span><span class=\"params\">(<span class=\"type\">int_t</span> argc, <span class=\"type\">char_t</span> *argv[])</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int_t</span> rc;</span><br><span class=\"line\">    <span class=\"type\">error_t</span> error;</span><br><span class=\"line\">    <span class=\"type\">uint8_t</span> seed[SEED_SIZE];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (argc == <span class=\"number\">2</span> &amp;&amp; osStrcmp(argv[<span class=\"number\">1</span>], <span class=\"string\">&quot;--help&quot;</span>) == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        printUsage(HELP);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * -b æŒ‡å®šå¯†é’¥é•¿åº¦ã€‚å¯¹äº RSA å¯†é’¥ï¼Œæœ€ä½åªæ”¯æŒ 2048</span></span><br><span class=\"line\"><span class=\"comment\">     * -f æŒ‡å®šå¯†é’¥æ–‡ä»¶å</span></span><br><span class=\"line\"><span class=\"comment\">     * -t æŒ‡å®šè¦åˆ›å»ºçš„å¯†é’¥ç±»å‹ã€‚ç›®å‰ä»…æ”¯æŒ rsa</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> ((rc = getopt(argc, argv, <span class=\"string\">&quot;b:f:t:&quot;</span>)) != <span class=\"number\">-1</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span> (rc) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">&#x27;b&#x27;</span>:</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"type\">uint_t</span> i = <span class=\"number\">0</span>; i &lt; osStrlen(optarg); ++i) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (osIsdigit(optarg[i]) == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                        printUsage(FAILED_BIT_TYPE);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                generateParam.bitSize = atoi(optarg);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (generateParam.bitSize &lt; MIN_SUPPORT_BYTES || generateParam.bitSize &gt; MAX_SUPPORT_BYTES) &#123;</span><br><span class=\"line\">                    printUsage(FAILED_BIT_SIZE);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">&#x27;f&#x27;</span>:</span><br><span class=\"line\">                generateParam.filename = optarg;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">&#x27;t&#x27;</span>:</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (osStrcmp(optarg, <span class=\"string\">&quot;rsa&quot;</span>) != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                    printUsage(HELP);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                generateParam.algorithm = optarg;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">default</span>:</span><br><span class=\"line\">                printUsage(HELP);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((error = yarrowInit(&amp;yarrowContext))) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Failed to initialize PRNG!\\r\\n&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> error;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((error = yarrowSeed(&amp;yarrowContext, seed, <span class=\"keyword\">sizeof</span>(seed)))) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Failed to seed PRNG!\\r\\n&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> error;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> generateRsaCertKeys();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br><span class=\"line\">417</span><br><span class=\"line\">418</span><br><span class=\"line\">419</span><br><span class=\"line\">420</span><br><span class=\"line\">421</span><br><span class=\"line\">422</span><br><span class=\"line\">423</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\"> *  Multi-precision integer library</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> *  Copyright The Mbed TLS Contributors</span></span><br><span class=\"line\"><span class=\"comment\"> *  SPDX-License-Identifier: Apache-2.0</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> *  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may</span></span><br><span class=\"line\"><span class=\"comment\"> *  not use this file except in compliance with the License.</span></span><br><span class=\"line\"><span class=\"comment\"> *  You may obtain a copy of the License at</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> *  http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> *  Unless required by applicable law or agreed to in writing, software</span></span><br><span class=\"line\"><span class=\"comment\"> *  distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT</span></span><br><span class=\"line\"><span class=\"comment\"> *  WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class=\"line\"><span class=\"comment\"> *  See the License for the specific language governing permissions and</span></span><br><span class=\"line\"><span class=\"comment\"> *  limitations under the License.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\"> *  The following sources were referenced in the design of this Multi-precision</span></span><br><span class=\"line\"><span class=\"comment\"> *  Integer library:</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> *  [1] Handbook of Applied Cryptography - 1997</span></span><br><span class=\"line\"><span class=\"comment\"> *      Menezes, van Oorschot and Vanstone</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> *  [2] Multi-Precision Math</span></span><br><span class=\"line\"><span class=\"comment\"> *      Tom St Denis</span></span><br><span class=\"line\"><span class=\"comment\"> *      https://github.com/libtom/libtommath/blob/develop/tommath.pdf</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> *  [3] GNU Multi-Precision Arithmetic Library</span></span><br><span class=\"line\"><span class=\"comment\"> *      https://gmplib.org/manual/index.html</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//!!!MODIFIED FILE!!!</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;core/crypto.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;mpi/mpi.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;rng/yarrow.h&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">extern</span> YarrowContext yarrowContext;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> MBEDTLS_MPI_CHK(f) <span class=\"keyword\">if</span>((ret = f) != 0) goto cleanup</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> mbedtls_mpi Mpi</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> mbedtls_mpi_sint int_t</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> mbedtls_mpi_uint uint_t</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> mbedtls_mpi_init mpiInit</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> mbedtls_mpi_free mpiFree</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> mbedtls_mpi_sub_int mpiSubInt</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> mbedtls_mpi_copy mpiCopy</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> mbedtls_mpi_shift_r mpiShiftRight</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> mbedtls_mpi_shift_l mpiShiftLeft</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> mbedtls_mpi_bitlen mpiGetBitLength</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> mbedtls_mpi_cmp_mpi mpiComp</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> mbedtls_mpi_cmp_int mpiCompInt</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> mbedtls_mpi_add_int mpiAddInt</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> mbedtls_mpi_mul_mpi mpiMul</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> mbedtls_mpi_mod_mpi mpiMod</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> mbedtls_mpi_inv_mod mpiInvMod</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> mbedtls_mpi_lset mpiSetValue</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> mbedtls_mpi_set_bit mpiSetBitValue</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> mbedtls_mpi_exp_mod mpiExpMod</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> mbedtls_mpi_sub_abs mpiSubAbs</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> mbedtls_mpi_fill_random(xx, nn, algo, ctx) mpiRand(xx, (nn) * 8, algo, ctx)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> ciL    (sizeof(mbedtls_mpi_uint))         <span class=\"comment\">/* chars in limb  */</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> biL    (ciL &lt;&lt; 3)               <span class=\"comment\">/* bits  in limb  */</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> biH    (ciL &lt;&lt; 2)               <span class=\"comment\">/* half limb size */</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> BITS_TO_LIMBS(i)  ( (i) / biL + ( (i) % biL != 0 ) )</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> CHARS_TO_LIMBS(i) ( (i) / ciL + ( (i) % ciL != 0 ) )</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> MBEDTLS_MPI_MAX_BITS 4096</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> MBEDTLS_ERR_MPI_NOT_ACCEPTABLE (2)</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> MBEDTLS_ERR_MPI_BAD_INPUT_DATA (3)</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> MBEDTLS_ERR_RSA_BAD_INPUT_DATA (4)</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> MBEDTLS_ERR_RSA_KEY_GEN_FAILED (5)</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> MBEDTLS_ERR_MPI_DIVISION_BY_ZERO (6)</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> MBEDTLS_ERR_MPI_NEGATIVE_VALUE (7)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">static</span> <span class=\"type\">const</span> <span class=\"type\">int</span> small_prime[] =</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">        <span class=\"number\">3</span>,    <span class=\"number\">5</span>,    <span class=\"number\">7</span>,   <span class=\"number\">11</span>,   <span class=\"number\">13</span>,   <span class=\"number\">17</span>,   <span class=\"number\">19</span>,   <span class=\"number\">23</span>,</span><br><span class=\"line\">       <span class=\"number\">29</span>,   <span class=\"number\">31</span>,   <span class=\"number\">37</span>,   <span class=\"number\">41</span>,   <span class=\"number\">43</span>,   <span class=\"number\">47</span>,   <span class=\"number\">53</span>,   <span class=\"number\">59</span>,</span><br><span class=\"line\">       <span class=\"number\">61</span>,   <span class=\"number\">67</span>,   <span class=\"number\">71</span>,   <span class=\"number\">73</span>,   <span class=\"number\">79</span>,   <span class=\"number\">83</span>,   <span class=\"number\">89</span>,   <span class=\"number\">97</span>,</span><br><span class=\"line\">      <span class=\"number\">101</span>,  <span class=\"number\">103</span>,  <span class=\"number\">107</span>,  <span class=\"number\">109</span>,  <span class=\"number\">113</span>,  <span class=\"number\">127</span>,  <span class=\"number\">131</span>,  <span class=\"number\">137</span>,</span><br><span class=\"line\">      <span class=\"number\">139</span>,  <span class=\"number\">149</span>,  <span class=\"number\">151</span>,  <span class=\"number\">157</span>,  <span class=\"number\">163</span>,  <span class=\"number\">167</span>,  <span class=\"number\">173</span>,  <span class=\"number\">179</span>,</span><br><span class=\"line\">      <span class=\"number\">181</span>,  <span class=\"number\">191</span>,  <span class=\"number\">193</span>,  <span class=\"number\">197</span>,  <span class=\"number\">199</span>,  <span class=\"number\">211</span>,  <span class=\"number\">223</span>,  <span class=\"number\">227</span>,</span><br><span class=\"line\">      <span class=\"number\">229</span>,  <span class=\"number\">233</span>,  <span class=\"number\">239</span>,  <span class=\"number\">241</span>,  <span class=\"number\">251</span>,  <span class=\"number\">257</span>,  <span class=\"number\">263</span>,  <span class=\"number\">269</span>,</span><br><span class=\"line\">      <span class=\"number\">271</span>,  <span class=\"number\">277</span>,  <span class=\"number\">281</span>,  <span class=\"number\">283</span>,  <span class=\"number\">293</span>,  <span class=\"number\">307</span>,  <span class=\"number\">311</span>,  <span class=\"number\">313</span>,</span><br><span class=\"line\">      <span class=\"number\">317</span>,  <span class=\"number\">331</span>,  <span class=\"number\">337</span>,  <span class=\"number\">347</span>,  <span class=\"number\">349</span>,  <span class=\"number\">353</span>,  <span class=\"number\">359</span>,  <span class=\"number\">367</span>,</span><br><span class=\"line\">      <span class=\"number\">373</span>,  <span class=\"number\">379</span>,  <span class=\"number\">383</span>,  <span class=\"number\">389</span>,  <span class=\"number\">397</span>,  <span class=\"number\">401</span>,  <span class=\"number\">409</span>,  <span class=\"number\">419</span>,</span><br><span class=\"line\">      <span class=\"number\">421</span>,  <span class=\"number\">431</span>,  <span class=\"number\">433</span>,  <span class=\"number\">439</span>,  <span class=\"number\">443</span>,  <span class=\"number\">449</span>,  <span class=\"number\">457</span>,  <span class=\"number\">461</span>,</span><br><span class=\"line\">      <span class=\"number\">463</span>,  <span class=\"number\">467</span>,  <span class=\"number\">479</span>,  <span class=\"number\">487</span>,  <span class=\"number\">491</span>,  <span class=\"number\">499</span>,  <span class=\"number\">503</span>,  <span class=\"number\">509</span>,</span><br><span class=\"line\">      <span class=\"number\">521</span>,  <span class=\"number\">523</span>,  <span class=\"number\">541</span>,  <span class=\"number\">547</span>,  <span class=\"number\">557</span>,  <span class=\"number\">563</span>,  <span class=\"number\">569</span>,  <span class=\"number\">571</span>,</span><br><span class=\"line\">      <span class=\"number\">577</span>,  <span class=\"number\">587</span>,  <span class=\"number\">593</span>,  <span class=\"number\">599</span>,  <span class=\"number\">601</span>,  <span class=\"number\">607</span>,  <span class=\"number\">613</span>,  <span class=\"number\">617</span>,</span><br><span class=\"line\">      <span class=\"number\">619</span>,  <span class=\"number\">631</span>,  <span class=\"number\">641</span>,  <span class=\"number\">643</span>,  <span class=\"number\">647</span>,  <span class=\"number\">653</span>,  <span class=\"number\">659</span>,  <span class=\"number\">661</span>,</span><br><span class=\"line\">      <span class=\"number\">673</span>,  <span class=\"number\">677</span>,  <span class=\"number\">683</span>,  <span class=\"number\">691</span>,  <span class=\"number\">701</span>,  <span class=\"number\">709</span>,  <span class=\"number\">719</span>,  <span class=\"number\">727</span>,</span><br><span class=\"line\">      <span class=\"number\">733</span>,  <span class=\"number\">739</span>,  <span class=\"number\">743</span>,  <span class=\"number\">751</span>,  <span class=\"number\">757</span>,  <span class=\"number\">761</span>,  <span class=\"number\">769</span>,  <span class=\"number\">773</span>,</span><br><span class=\"line\">      <span class=\"number\">787</span>,  <span class=\"number\">797</span>,  <span class=\"number\">809</span>,  <span class=\"number\">811</span>,  <span class=\"number\">821</span>,  <span class=\"number\">823</span>,  <span class=\"number\">827</span>,  <span class=\"number\">829</span>,</span><br><span class=\"line\">      <span class=\"number\">839</span>,  <span class=\"number\">853</span>,  <span class=\"number\">857</span>,  <span class=\"number\">859</span>,  <span class=\"number\">863</span>,  <span class=\"number\">877</span>,  <span class=\"number\">881</span>,  <span class=\"number\">883</span>,</span><br><span class=\"line\">      <span class=\"number\">887</span>,  <span class=\"number\">907</span>,  <span class=\"number\">911</span>,  <span class=\"number\">919</span>,  <span class=\"number\">929</span>,  <span class=\"number\">937</span>,  <span class=\"number\">941</span>,  <span class=\"number\">947</span>,</span><br><span class=\"line\">      <span class=\"number\">953</span>,  <span class=\"number\">967</span>,  <span class=\"number\">971</span>,  <span class=\"number\">977</span>,  <span class=\"number\">983</span>,  <span class=\"number\">991</span>,  <span class=\"number\">997</span>, <span class=\"number\">-103</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\"> * Return the number of less significant zero-bits</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"type\">size_t</span> <span class=\"title function_\">mbedtls_mpi_lsb</span><span class=\"params\">( <span class=\"type\">const</span> mbedtls_mpi *X )</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"type\">size_t</span> i, j, count = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span>( i = <span class=\"number\">0</span>; i &lt; X-&gt;size; i++ )</span><br><span class=\"line\">        <span class=\"keyword\">for</span>( j = <span class=\"number\">0</span>; j &lt; <span class=\"number\">32</span>; j++, count++ )</span><br><span class=\"line\">            <span class=\"keyword\">if</span>( ( ( X-&gt;data[i] &gt;&gt; j ) &amp; <span class=\"number\">1</span> ) != <span class=\"number\">0</span> )</span><br><span class=\"line\">                <span class=\"keyword\">return</span>( count );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span>( <span class=\"number\">0</span> );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\"> * Modulo: r = A mod b</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">mbedtls_mpi_mod_int</span><span class=\"params\">( mbedtls_mpi_uint *r, <span class=\"type\">const</span> mbedtls_mpi *A, mbedtls_mpi_sint b )</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"type\">size_t</span> i;</span><br><span class=\"line\">    mbedtls_mpi_uint x, y, z;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( b == <span class=\"number\">0</span> )</span><br><span class=\"line\">        <span class=\"keyword\">return</span>( MBEDTLS_ERR_MPI_DIVISION_BY_ZERO );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( b &lt; <span class=\"number\">0</span> )</span><br><span class=\"line\">        <span class=\"keyword\">return</span>( MBEDTLS_ERR_MPI_NEGATIVE_VALUE );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">     * handle trivial cases</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( b == <span class=\"number\">1</span> )</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        *r = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>( <span class=\"number\">0</span> );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( b == <span class=\"number\">2</span> )</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        *r = A-&gt;data[<span class=\"number\">0</span>] &amp; <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>( <span class=\"number\">0</span> );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">     * general case</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span>( i = A-&gt;size, y = <span class=\"number\">0</span>; i &gt; <span class=\"number\">0</span>; i-- )</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        x  = A-&gt;data[i - <span class=\"number\">1</span>];</span><br><span class=\"line\">        y  = ( y &lt;&lt; biH ) | ( x &gt;&gt; biH );</span><br><span class=\"line\">        z  = y / b;</span><br><span class=\"line\">        y -= z * b;</span><br><span class=\"line\"></span><br><span class=\"line\">        x &lt;&lt;= biH;</span><br><span class=\"line\">        y  = ( y &lt;&lt; biH ) | ( x &gt;&gt; biH );</span><br><span class=\"line\">        z  = y / b;</span><br><span class=\"line\">        y -= z * b;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">     * If A is negative, then the current y represents a negative value.</span></span><br><span class=\"line\"><span class=\"comment\">     * Flipping it to the positive side.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( A-&gt;sign &lt; <span class=\"number\">0</span> &amp;&amp; y != <span class=\"number\">0</span> )</span><br><span class=\"line\">        y = b - y;</span><br><span class=\"line\"></span><br><span class=\"line\">    *r = y;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span>( <span class=\"number\">0</span> );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\"> * Greatest common divisor: G = gcd(A, B)  (HAC 14.54)</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">mbedtls_mpi_gcd</span><span class=\"params\">( mbedtls_mpi *G, <span class=\"type\">const</span> mbedtls_mpi *A, <span class=\"type\">const</span> mbedtls_mpi *B )</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> ret;</span><br><span class=\"line\">    <span class=\"type\">size_t</span> lz, lzt;</span><br><span class=\"line\">    mbedtls_mpi TG, TA, TB;</span><br><span class=\"line\"></span><br><span class=\"line\">    mbedtls_mpi_init( &amp;TG ); mbedtls_mpi_init( &amp;TA ); mbedtls_mpi_init( &amp;TB );</span><br><span class=\"line\"></span><br><span class=\"line\">    MBEDTLS_MPI_CHK( mbedtls_mpi_copy( &amp;TA, A ) );</span><br><span class=\"line\">    MBEDTLS_MPI_CHK( mbedtls_mpi_copy( &amp;TB, B ) );</span><br><span class=\"line\"></span><br><span class=\"line\">    lz = mbedtls_mpi_lsb( &amp;TA );</span><br><span class=\"line\">    lzt = mbedtls_mpi_lsb( &amp;TB );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( lzt &lt; lz )</span><br><span class=\"line\">        lz = lzt;</span><br><span class=\"line\"></span><br><span class=\"line\">    MBEDTLS_MPI_CHK( mbedtls_mpi_shift_r( &amp;TA, lz ) );</span><br><span class=\"line\">    MBEDTLS_MPI_CHK( mbedtls_mpi_shift_r( &amp;TB, lz ) );</span><br><span class=\"line\"></span><br><span class=\"line\">    TA.sign = TB.sign = <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span>( mbedtls_mpi_cmp_int( &amp;TA, <span class=\"number\">0</span> ) != <span class=\"number\">0</span> )</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        MBEDTLS_MPI_CHK( mbedtls_mpi_shift_r( &amp;TA, mbedtls_mpi_lsb( &amp;TA ) ) );</span><br><span class=\"line\">        MBEDTLS_MPI_CHK( mbedtls_mpi_shift_r( &amp;TB, mbedtls_mpi_lsb( &amp;TB ) ) );</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>( mbedtls_mpi_cmp_mpi( &amp;TA, &amp;TB ) &gt;= <span class=\"number\">0</span> )</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            MBEDTLS_MPI_CHK( mbedtls_mpi_sub_abs( &amp;TA, &amp;TA, &amp;TB ) );</span><br><span class=\"line\">            MBEDTLS_MPI_CHK( mbedtls_mpi_shift_r( &amp;TA, <span class=\"number\">1</span> ) );</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            MBEDTLS_MPI_CHK( mbedtls_mpi_sub_abs( &amp;TB, &amp;TB, &amp;TA ) );</span><br><span class=\"line\">            MBEDTLS_MPI_CHK( mbedtls_mpi_shift_r( &amp;TB, <span class=\"number\">1</span> ) );</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    MBEDTLS_MPI_CHK( mbedtls_mpi_shift_l( &amp;TB, lz ) );</span><br><span class=\"line\">    MBEDTLS_MPI_CHK( mbedtls_mpi_copy( G, &amp;TB ) );</span><br><span class=\"line\"></span><br><span class=\"line\">cleanup:</span><br><span class=\"line\"></span><br><span class=\"line\">    mbedtls_mpi_free( &amp;TG );</span><br><span class=\"line\">    mbedtls_mpi_free( &amp;TA );</span><br><span class=\"line\">    mbedtls_mpi_free( &amp;TB );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span>( ret );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\"> * Small divisors test (X must be positive)</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * Return values:</span></span><br><span class=\"line\"><span class=\"comment\"> * 0: no small factor (possible prime, more tests needed)</span></span><br><span class=\"line\"><span class=\"comment\"> * 1: certain prime</span></span><br><span class=\"line\"><span class=\"comment\"> * MBEDTLS_ERR_MPI_NOT_ACCEPTABLE: certain non-prime</span></span><br><span class=\"line\"><span class=\"comment\"> * other negative: error</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"type\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">mpi_check_small_factors</span><span class=\"params\">( <span class=\"type\">const</span> mbedtls_mpi *X )</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> ret = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"type\">size_t</span> i;</span><br><span class=\"line\">    mbedtls_mpi_uint r;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( ( X-&gt;data[<span class=\"number\">0</span>] &amp; <span class=\"number\">1</span> ) == <span class=\"number\">0</span> )</span><br><span class=\"line\">        <span class=\"keyword\">return</span>( MBEDTLS_ERR_MPI_NOT_ACCEPTABLE );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span>( i = <span class=\"number\">0</span>; small_prime[i] &gt; <span class=\"number\">0</span>; i++ )</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>( mbedtls_mpi_cmp_int( X, small_prime[i] ) &lt;= <span class=\"number\">0</span> )</span><br><span class=\"line\">            <span class=\"keyword\">return</span>( <span class=\"number\">1</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">        MBEDTLS_MPI_CHK( mbedtls_mpi_mod_int( &amp;r, X, small_prime[i] ) );</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>( r == <span class=\"number\">0</span> )</span><br><span class=\"line\">            <span class=\"keyword\">return</span>( MBEDTLS_ERR_MPI_NOT_ACCEPTABLE );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">cleanup:</span><br><span class=\"line\">    <span class=\"keyword\">return</span>( ret );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\"> * Miller-Rabin pseudo-primality test  (HAC 4.24)</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"type\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">mpi_miller_rabin</span><span class=\"params\">( <span class=\"type\">const</span> mbedtls_mpi *X,</span></span><br><span class=\"line\"><span class=\"params\">                             <span class=\"type\">const</span> PrngAlgo *prngAlgo, <span class=\"type\">void</span> *prngContext)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> ret, count;</span><br><span class=\"line\">    <span class=\"type\">size_t</span> i, j, k, n, s;</span><br><span class=\"line\">    mbedtls_mpi W, R, T, A; <span class=\"comment\">//, RR;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    mbedtls_mpi_init( &amp;W );</span><br><span class=\"line\">    mbedtls_mpi_init( &amp;R );</span><br><span class=\"line\">    mbedtls_mpi_init( &amp;T );</span><br><span class=\"line\">    mbedtls_mpi_init( &amp;A );</span><br><span class=\"line\">    <span class=\"comment\">//mbedtls_mpi_init( &amp;RR );</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">     * W = |X| - 1</span></span><br><span class=\"line\"><span class=\"comment\">     * R = W &gt;&gt; lsb( W )</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    MBEDTLS_MPI_CHK( mbedtls_mpi_sub_int( &amp;W, X, <span class=\"number\">1</span> ) );</span><br><span class=\"line\">    s = mbedtls_mpi_lsb( &amp;W );</span><br><span class=\"line\">    MBEDTLS_MPI_CHK( mbedtls_mpi_copy( &amp;R, &amp;W ) );</span><br><span class=\"line\">    MBEDTLS_MPI_CHK( mbedtls_mpi_shift_r( &amp;R, s ) );</span><br><span class=\"line\"></span><br><span class=\"line\">    i = mbedtls_mpi_bitlen( X );</span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">     * HAC, table 4.4</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    n = ( ( i &gt;= <span class=\"number\">1300</span> ) ?  <span class=\"number\">2</span> : ( i &gt;=  <span class=\"number\">850</span> ) ?  <span class=\"number\">3</span> :</span><br><span class=\"line\">          ( i &gt;=  <span class=\"number\">650</span> ) ?  <span class=\"number\">4</span> : ( i &gt;=  <span class=\"number\">350</span> ) ?  <span class=\"number\">8</span> :</span><br><span class=\"line\">          ( i &gt;=  <span class=\"number\">250</span> ) ? <span class=\"number\">12</span> : ( i &gt;=  <span class=\"number\">150</span> ) ? <span class=\"number\">18</span> : <span class=\"number\">27</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span>( i = <span class=\"number\">0</span>; i &lt; n; i++ )</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">         * pick a random A, 1 &lt; A &lt; |X| - 1</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        MBEDTLS_MPI_CHK( mbedtls_mpi_fill_random( &amp;A, X-&gt;size * ciL, prngAlgo, prngContext ) );</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>( mbedtls_mpi_cmp_mpi( &amp;A, &amp;W ) &gt;= <span class=\"number\">0</span> )</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            j = mbedtls_mpi_bitlen( &amp;A ) - mbedtls_mpi_bitlen( &amp;W );</span><br><span class=\"line\">            MBEDTLS_MPI_CHK( mbedtls_mpi_shift_r( &amp;A, j + <span class=\"number\">1</span> ) );</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        A.data[<span class=\"number\">0</span>] |= <span class=\"number\">3</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        count = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">            MBEDTLS_MPI_CHK( mbedtls_mpi_fill_random( &amp;A, X-&gt;size * ciL, prngAlgo, prngContext ) );</span><br><span class=\"line\"></span><br><span class=\"line\">            j = mbedtls_mpi_bitlen( &amp;A );</span><br><span class=\"line\">            k = mbedtls_mpi_bitlen( &amp;W );</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (j &gt; k) &#123;</span><br><span class=\"line\">                MBEDTLS_MPI_CHK( mbedtls_mpi_shift_r( &amp;A, j - k ) );</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (count++ &gt; <span class=\"number\">30</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> MBEDTLS_ERR_MPI_NOT_ACCEPTABLE;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125; <span class=\"keyword\">while</span> ( mbedtls_mpi_cmp_mpi( &amp;A, &amp;W ) &gt;= <span class=\"number\">0</span> ||</span><br><span class=\"line\">                  mbedtls_mpi_cmp_int( &amp;A, <span class=\"number\">1</span> )  &lt;= <span class=\"number\">0</span>    );</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">         * A = A^R mod |X|</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        MBEDTLS_MPI_CHK( mbedtls_mpi_exp_mod( &amp;A, &amp;A, &amp;R, X <span class=\"comment\">/*, &amp;RR*/</span> ) );</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span>( mbedtls_mpi_cmp_mpi( &amp;A, &amp;W ) == <span class=\"number\">0</span> ||</span><br><span class=\"line\">            mbedtls_mpi_cmp_int( &amp;A,  <span class=\"number\">1</span> ) == <span class=\"number\">0</span> )</span><br><span class=\"line\">            <span class=\"keyword\">continue</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        j = <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>( j &lt; s &amp;&amp; mbedtls_mpi_cmp_mpi( &amp;A, &amp;W ) != <span class=\"number\">0</span> )</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">             * A = A * A mod |X|</span></span><br><span class=\"line\"><span class=\"comment\">             */</span></span><br><span class=\"line\">            MBEDTLS_MPI_CHK( mbedtls_mpi_mul_mpi( &amp;T, &amp;A, &amp;A ) );</span><br><span class=\"line\">            MBEDTLS_MPI_CHK( mbedtls_mpi_mod_mpi( &amp;A, &amp;T, X  ) );</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span>( mbedtls_mpi_cmp_int( &amp;A, <span class=\"number\">1</span> ) == <span class=\"number\">0</span> )</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            j++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">         * not prime if A != |X| - 1 or A == 1</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>( mbedtls_mpi_cmp_mpi( &amp;A, &amp;W ) != <span class=\"number\">0</span> ||</span><br><span class=\"line\">            mbedtls_mpi_cmp_int( &amp;A,  <span class=\"number\">1</span> ) == <span class=\"number\">0</span> )</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            ret = MBEDTLS_ERR_MPI_NOT_ACCEPTABLE;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">cleanup:</span><br><span class=\"line\">    mbedtls_mpi_free( &amp;W );</span><br><span class=\"line\">    mbedtls_mpi_free( &amp;R );</span><br><span class=\"line\">    mbedtls_mpi_free( &amp;T );</span><br><span class=\"line\">    mbedtls_mpi_free( &amp;A );</span><br><span class=\"line\">    <span class=\"comment\">//mbedtls_mpi_free( &amp;RR );</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span>( ret );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\"> * Pseudo-primality test: small factors, then Miller-Rabin</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">mbedtls_mpi_is_prime</span><span class=\"params\">( <span class=\"type\">const</span> mbedtls_mpi *X,</span></span><br><span class=\"line\"><span class=\"params\">                  <span class=\"type\">const</span> PrngAlgo *prngAlgo, <span class=\"type\">void</span> *prngContext )</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> ret;</span><br><span class=\"line\">    mbedtls_mpi XX;</span><br><span class=\"line\"></span><br><span class=\"line\">    XX.sign = <span class=\"number\">1</span>;</span><br><span class=\"line\">    XX.size = X-&gt;size;</span><br><span class=\"line\">    XX.data = X-&gt;data;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( mbedtls_mpi_cmp_int( &amp;XX, <span class=\"number\">0</span> ) == <span class=\"number\">0</span> ||</span><br><span class=\"line\">        mbedtls_mpi_cmp_int( &amp;XX, <span class=\"number\">1</span> ) == <span class=\"number\">0</span> )</span><br><span class=\"line\">        <span class=\"keyword\">return</span>( MBEDTLS_ERR_MPI_NOT_ACCEPTABLE );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( mbedtls_mpi_cmp_int( &amp;XX, <span class=\"number\">2</span> ) == <span class=\"number\">0</span> )</span><br><span class=\"line\">        <span class=\"keyword\">return</span>( <span class=\"number\">0</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>( ( ret = mpi_check_small_factors( &amp;XX ) ) != <span class=\"number\">0</span> )</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>( ret == <span class=\"number\">1</span> )</span><br><span class=\"line\">            <span class=\"keyword\">return</span>( <span class=\"number\">0</span> );</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span>( ret );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span>( mpi_miller_rabin( &amp;XX, prngAlgo, prngContext ) );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">error_t</span> <span class=\"title function_\">mpiCheckProbablePrime</span><span class=\"params\">(<span class=\"type\">const</span> Mpi *a)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">   <span class=\"type\">int</span> err;</span><br><span class=\"line\">   </span><br><span class=\"line\">   err = mbedtls_mpi_is_prime(a, YARROW_PRNG_ALGO, &amp;yarrowContext);</span><br><span class=\"line\">   </span><br><span class=\"line\">   <span class=\"keyword\">if</span>(err == <span class=\"number\">0</span>)</span><br><span class=\"line\">      <span class=\"keyword\">return</span> NO_ERROR;</span><br><span class=\"line\">   <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(err == MBEDTLS_ERR_MPI_NOT_ACCEPTABLE)</span><br><span class=\"line\">      <span class=\"keyword\">return</span> ERROR_INVALID_VALUE;</span><br><span class=\"line\">   <span class=\"keyword\">else</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> ERROR_FAILURE;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">TIP</p>\n<p>åŸºäºæ ‡å‡†çš„ Posix æ¥å£å’Œ CycloneCRYPTO å®Œæˆçš„ ssh-keygen å®¢æˆ·ç«¯ï¼Œå¯ä»¥ç”¨äºç”Ÿæˆ rsa çš„ç§˜é’¥å¯¹ï¼ŒCycloneCRYPTO å®˜æ–¹å¹¶æœªæä¾›ç´ æ•°ç”Ÿæˆçš„ç®—æ³•ï¼Œæ­¤ä¸ºå¼€æºçš„ä¸€ä¸ªç´ æ•°ç®—æ³•å®ç°ã€‚</p>\n</div>\n","feature":true,"text":"RSA åŠ å¯†æ˜¯ä¸€ç§éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œä½¿ç”¨ä¸€å¯¹å¯†é’¥è¿›è¡ŒåŠ è§£å¯†ï¼Œåˆ†åˆ«ä¸ºå…¬é’¥å’Œç§é’¥ã€‚å…¬é’¥ç”¨äºåŠ å¯†ä¿¡æ¯ï¼Œç§é’¥ç”¨äºè§£å¯†ä¿¡æ¯ã€‚è¿™ç§è®¾ç½®ä½¿å¾—å‘é€è€…å¯ä»¥ä½¿ç”¨å…¬é’¥åŠ å¯†ä¿¡æ¯å¹¶å‘é€ç»™æ¥æ”¶è€…ï¼Œè€Œåªæœ‰æ¥æ”¶è€…æŒæœ‰ç›¸åº”ç§é’¥æ‰èƒ½è§£å¯†å¹¶è¯»å–ä¿¡æ¯ã€‚...","permalink":"/post/RSA-éå¯¹ç§°åŠ å¯†","photos":[],"count_time":{"symbolsCount":"25k","symbolsTime":"23 mins."},"categories":[],"tags":[{"name":"åŠ å¯†ç®—æ³•","slug":"åŠ å¯†ç®—æ³•","count":1,"path":"api/tags/åŠ å¯†ç®—æ³•.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%9D%9E%E5%AF%B9%E7%A7%B0%E4%B8%8E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86\"><span class=\"toc-text\">éå¯¹ç§°ä¸å¯¹ç§°åŠ å¯†</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86\"><span class=\"toc-text\">éå¯¹ç§°åŠ å¯†</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF\"><span class=\"toc-text\">éå¯¹ç§°åŠ å¯†çš„åº”ç”¨åœºæ™¯</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86\"><span class=\"toc-text\">å¯¹ç§°åŠ å¯†</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF\"><span class=\"toc-text\">å¯¹ç§°åŠ å¯†åº”ç”¨åœºæ™¯</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%94%9F%E6%88%90%E7%A7%98%E9%92%A5%E5%AF%B9\"><span class=\"toc-text\">ç”Ÿæˆç§˜é’¥å¯¹</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#PHP-RSA-%E5%8A%A0%E8%A7%A3%E5%AF%86\"><span class=\"toc-text\">PHP RSA åŠ è§£å¯†</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%A7%BB%E6%A4%8D-ssh-keygen-%E5%AE%A2%E6%88%B7%E7%AB%AF\"><span class=\"toc-text\">ç§»æ¤ ssh-keygen å®¢æˆ·ç«¯</span></a></li></ol>","author":{"name":"å“ªå’","slug":"blog-author","avatar":"https://pic.imgdb.cn/item/65ba193b871b83018a65323c.jpg","link":"/","description":"äººå¿ƒä¸­çš„æˆè§å°±åƒä¸€åº§å¤§å±±ï¼Œä»»ä½ æ€ä¹ˆåŠªåŠ›ä¹Ÿä¼‘æƒ³æ¬åŠ¨ã€‚","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"MySQL è¯»å†™åˆ†ç¦»","uid":"263e776b7c4ab948e2c3d7edc00d6223","slug":"MySQL-è¯»å†™åˆ†ç¦»","date":"2024-02-26T12:27:04.000Z","updated":"2024-02-26T13:37:02.893Z","comments":true,"path":"api/articles/MySQL-è¯»å†™åˆ†ç¦».json","keywords":null,"cover":null,"text":"MySQL è¯»å†™åˆ†ç¦»æ˜¯ä¸€ç§æ•°æ®åº“æ¶æ„è®¾è®¡æ¨¡å¼ï¼Œæ—¨åœ¨æé«˜æ•°æ®åº“æ€§èƒ½å’Œå¯ä¼¸ç¼©æ€§ã€‚å®ƒé€šè¿‡å°†è¯»è¯·æ±‚å’Œå†™è¯·æ±‚åˆ†å‘åˆ°ä¸åŒçš„æ•°æ®åº“å®ä¾‹ä¸Šæ¥å®ç°ã€‚...","permalink":"/post/MySQL-è¯»å†™åˆ†ç¦»","photos":[],"count_time":{"symbolsCount":"5.6k","symbolsTime":"5 mins."},"categories":[],"tags":[{"name":"MySQL","slug":"MySQL","count":1,"path":"api/tags/MySQL.json"}],"author":{"name":"å“ªå’","slug":"blog-author","avatar":"https://pic.imgdb.cn/item/65ba193b871b83018a65323c.jpg","link":"/","description":"äººå¿ƒä¸­çš„æˆè§å°±åƒä¸€åº§å¤§å±±ï¼Œä»»ä½ æ€ä¹ˆåŠªåŠ›ä¹Ÿä¼‘æƒ³æ¬åŠ¨ã€‚","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"Compoer","uid":"709b09d4ae43a807a27c1aa5f06ca26b","slug":"Compoer","date":"2024-02-22T10:58:00.000Z","updated":"2024-02-26T07:46:36.785Z","comments":true,"path":"api/articles/Compoer.json","keywords":null,"cover":[],"text":"Composer ä½œä¸ºç›®å‰ PHP åŒ…ä¾èµ–ç®¡ç†çš„æœ€ä½³å·¥å…·ï¼Œå€¼å¾—æ¯ä¸€ä½ PHP å¼€å‘äººå‘˜æŒæ¡ã€‚...","permalink":"/post/Compoer","photos":[],"count_time":{"symbolsCount":"2.9k","symbolsTime":"3 mins."},"categories":[],"tags":[{"name":"PHP","slug":"PHP","count":1,"path":"api/tags/PHP.json"}],"author":{"name":"å“ªå’","slug":"blog-author","avatar":"https://pic.imgdb.cn/item/65ba193b871b83018a65323c.jpg","link":"/","description":"äººå¿ƒä¸­çš„æˆè§å°±åƒä¸€åº§å¤§å±±ï¼Œä»»ä½ æ€ä¹ˆåŠªåŠ›ä¹Ÿä¼‘æƒ³æ¬åŠ¨ã€‚","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}